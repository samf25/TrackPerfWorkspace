variables:
  GIT_SUBMODULE_STRATEGY: normal

stages:
  - build
  - run

.base:
  image: gitlab-registry.cern.ch/muon-collider/mucoll-deploy/mucoll:2.8-patch2-el9

build:
  extends: .base
  stage: build
  script:
    - source /opt/setup_mucoll.sh || yes
    - ls
    - cmake -S . -B build
    - cmake --build build
  artifacts:
    name: build
    when: always
    paths:
      - $CI_PROJECT_DIR/build
    expire_in: 1 day
generate:
  extends: .base
  stage: build
  script:
    - curl https://nbartosi.web.cern.ch/tutorial_20230705/sim_Hbb/output_sim.slcio --output ./output_sim.slcio
  artifacts:
    name: input
    when: always
    paths:
      - $CI_PROJECT_DIR/output_sim.slcio
    expire_in: 1 day
run:
  extends: .base
  stage: run
  variables:
    MUCOLL_GEO: /opt/spack/opt/spack/linux-almalinux9-x86_64/gcc-11.3.1/lcgeo-0.18.1-rv5ol74iupibxoku3ktvpgjseph6nj5k/share/lcgeo/compact/MuColl/MuColl_v1/MuColl_v1.xml
  script:
    - source ci/safesource.sh source setup.sh build/
    - Marlin ${MYWORKSPACE}/example/actsseedckf_steer.xml --InitDD4hep.DD4hepXMLFile=${MUCOLL_GEO} --global.LCIOInputFiles=output_sim.slcio
  artifacts:
    name: output
    when: always
    paths:
      - $CI_PROJECT_DIR/actsseedckf.root
    expire_in: 30 day

